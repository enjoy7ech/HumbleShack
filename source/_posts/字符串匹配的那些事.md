---
title: å­—ç¬¦ä¸²åŒ¹é…çš„é‚£äº›äº‹
date: 1977-04-20 09:57:01
tags: [ç®—æ³•, å­—ç¬¦ä¸²]
categories: ç®—æ³•ä¹‹è·¯
keywords: å­—ç¬¦ä¸², å­—ç¬¦ä¸²åŒ¹é…, KMPç®—æ³•, BMç®—æ³•
description: å¦‚ä½•åœ¨ä¸€æœ¬ç”µå­ä¹¦ä¸­å¿«é€Ÿæ‰¾åˆ°ä½ å…³æ³¨çš„äººç‰©è¯´è¿‡é‚£äº›è¯ï¼Ÿå¸¦ä½ äº†è§£ç¨‹åºå‘˜æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸€é—®é¢˜çš„ã€‚
thumbnail: https://pan.dongzx.lol/api/v4/file/content/G0wIJ/0/kmp-algorithm.png?sign=QBV76DKM1c56jDHzr2vfuDblehP2whRsLEb51bs_FjI%3D%3A0
top_img: https://pan.dongzx.lol/api/v4/file/content/G0wIJ/0/kmp-algorithm.png?sign=QBV76DKM1c56jDHzr2vfuDblehP2whRsLEb51bs_FjI%3D%3A0
cover: https://pan.dongzx.lol/api/v4/file/content/G0wIJ/0/kmp-algorithm.png?sign=QBV76DKM1c56jDHzr2vfuDblehP2whRsLEb51bs_FjI%3D%3A0
excerpt: åœ¨è®¡ç®—æœºè¯ç”Ÿçš„é‚£å¤©å¼€å§‹ï¼Œå­ä¸²åŒ¹é…ä¸€ç›´å°±æ˜¯æœ€æ™®éçš„éœ€æ±‚ï¼Œå®ƒå°±åƒæˆ‘ä»¬æ¯å¤©å¯¹äº‹ç‰©çš„éœ€æ±‚é‚£æ ·å¹³å¸¸ï¼Œå›´ç»•å­ä¸²åŒ¹é…è¿™ä¸€é—®é¢˜ï¼Œè¯ç”Ÿäº†è®¸å¤šçš„å‡ç»“ç€æ™ºæ…§ä¸å¿ƒè¡€çš„ç®—æ³•ã€‚
---

åœ¨è®¡ç®—æœºè¯ç”Ÿçš„é‚£å¤©å¼€å§‹ï¼Œå­ä¸²åŒ¹é…ä¸€ç›´å°±æ˜¯æœ€æ™®éçš„éœ€æ±‚ï¼Œå®ƒå°±åƒæˆ‘ä»¬æ¯å¤©å¯¹é£Ÿç‰©çš„éœ€æ±‚é‚£æ ·å¹³å¸¸ï¼Œå›´ç»•å­ä¸²åŒ¹é…è¿™ä¸€é—®é¢˜ï¼Œè¯ç”Ÿäº†è®¸å¤šçš„å‡ç»“ç€æ™ºæ…§ä¸å¿ƒè¡€çš„ç®—æ³•ã€‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆæ˜ç¡®å‡ ä¸ª`æœ¯è¯­`:

1. **Text** æ–‡æœ¬ä¸²ï¼Œå³å¾…æ£€ç´¢çš„å­—ç¬¦ä¸²ï¼Œä¸‹æ–‡ç®€ç§°`T`ä¸²ã€‚
2. **Pattern** åœ¨è‹±æ–‡ä¸­æ˜¯æŒ‡ä¸€ç§å¯å¤ç”¨çš„è®¾è®¡æ–¹å¼ï¼Œåœ¨è¿™é‡Œå¾…åŒ¹é…çš„å­—ç¬¦ä¸²å¯ä»¥è¯´æ˜¯ä¸€ä¸ªé‡å¤çš„è¯ï¼Œä¸‹æ–‡ç®€ç§°`P`ä¸²ã€‚

## Brute Force algorithm (æš´åŠ›ç®—æ³•)

åœ¨æœ€åˆï¼Œäººä»¬ä½¿ç”¨æœ€ç›´è§‚çš„é€»è¾‘æ€ç»´è¿›è¡Œå­ä¸²åŒ¹é…ï¼ŒæŠŠ P ä» T çš„å¤´éƒ¨åˆ°å°¾éƒ¨ä¸€ä¸ªä¸ªæŒ‰ä½æ¯”è¾ƒå³å¯ã€‚æ¯”å¦‚ï¼š

{% tabs Brute Force algorithm %}

<!-- tab 1 -->

{% asset_img 1.png ä»ç¬¬ä¸€ä½å¼€å§‹åŒ¹é… %}

<!-- endtab -->
<!-- tab 2 -->

{% asset_img 2.png ä»ç¬¬ä¸€ä½å¼€å§‹åŒ¹é… %}

<!-- endtab -->

<!-- tab ...n -->

{% asset_img 3.png åŒ¹é…åˆ°æœ€åæ‰åŒ¹é…ä¸Š %}

<!-- endtab -->

{% endtabs %}

å¾ˆå®¹æ˜“åˆ†æè¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯{% katex %}O(nm){% endkatex %}çš„ï¼Œæ¯ä¸ªä½ç½®æœ€å·®æ¯”è¾ƒ `m`(P ä¸²é•¿åº¦)æ¬¡ã€‚

ä½†æ˜¯è¿™ç§æ–¹å¼æ˜¯ä½æ•ˆçš„ï¼Œå¯ä»¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

{% asset_img 4.png  %}

æŒ‰ç…§æš´åŠ›ç®—æ³•çš„é€»è¾‘ï¼Œåœ¨å¤±é…æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“å‰ä¸‰ä½æ˜¯ ABC`å…¨åŒ¹é…`çš„çŠ¶æ€ï¼Œæ­¤æ—¶åº”è¯¥æŠŠ P ä¸²å³ç§»åˆ°å¤±é…ä½ç½®è€Œä¸æ˜¯æŠŠ P ä¸²å¾€åç§»åŠ¨ä¸€ä½é‡æ–°å¼€å§‹åŒ¹é…ã€‚æ¢å¥è¯è¯´ï¼Œå¯¹ T ä¸²çš„åŒ¹é…è®°å¿†æ²¡æœ‰åˆç†åˆ©ç”¨èµ·æ¥ã€‚å¦‚ä½•**åˆ©ç”¨æœ€å°‘çš„æ¯”è¾ƒæ¬¡æ•°è·å¾—æœ€å¤§çš„ P ä¸²å³ç§»**ä¾¿æˆäº†å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•çš„æ ¸å¿ƒã€‚

## Knuthâ€“Morrisâ€“Pratt algorithm (KMP ç®—æ³•)

è¯¥ç®—æ³•ç”±ç”± Donald Knuth`1974å¹´å›¾çµå¥–å¾—ä¸»`ã€ James H. Morrisã€ Vaughan Pratt äº 1977 å¹´å‘è¡¨ã€‚ä¹Ÿæ˜¯ KMP ç®—æ³•åç§°çš„ç”±æ¥ã€‚
é’ˆå¯¹ T ä¸²çš„åŒ¹é…è®°å¿†ï¼ŒKMP ç®—æ³•ä¼šåˆ©ç”¨èµ·æ¥åŠ é€ŸåŒ¹é…ã€‚æ•´ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼Œè¿˜æ˜¯ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼š

{% tabs Brute Force algorithm %}

<!-- tab 1 -->

{% asset_img 4.png é¦–æ¬¡å¤±é…ï¼Œæˆ‘ä»¬çŸ¥é“ABCæ˜¯å…¨åŒ¹é…çš„ï¼Œå¯ä»¥ç›´æ¥å³ç§»æ•´ä¸ªPä¸²åˆ°å¤±é…ä½ç½® %}

{% asset_img 4_1.png å†æ¬¡å¤±é…ï¼ŒPä¸²å¾€åç§»ä¸€æ ¼ï¼Œè¿™æ­¥å¹¶æ²¡æœ‰åŠ é€Ÿç­–ç•¥ï¼Œä¸æš´åŠ›ç®—æ³•æ˜¯ç›¸åŒçš„ %}

<!-- endtab -->
<!-- tab 2 -->

{% asset_img 5.png å†æ¬¡å¤±é… %}

> å†æ¬¡å¤±é…æ—¶ï¼Œä¸éš¾å‘ç°ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥åƒç¬¬ä¸€æ­¥é‚£ä¹ˆæ“ä½œäº†ï¼Œå› ä¸º`æ­¤æ—¶å…¨åŒ¹é…çš„å­ä¸²å‰ä¸¤ä½ä¸åä¸¤ä½æ˜¯ä¸€æ ·çš„ï¼Œæ­¤æ—¶åº”è¯¥æŠŠPä¸²çš„å‰ä¸¤ä½ABä¸Tä¸²çš„ABï¼ˆæ­¤æ—¶å¤„äºå¤±é…ä½ç½®çš„å‰ä¸¤ä½ï¼‰å¯¹é½`ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“æƒ³é€šçš„é€»è¾‘ã€‚

<!-- endtab -->

<!-- tab 3 -->

{% asset_img 6.png å°±åƒè¿™æ · %}

> ç”±äºå¯¹é½å AB æ˜¯è‚¯å®šå·²ç»å¤„äºåŒ¹é…çŠ¶æ€äº†ï¼Œå› æ­¤ç›´æ¥ä»ä¸Šä¸€æ­¥çš„å¤±é…ä½ç½®å¼€å§‹åŒ¹é…ã€‚
> æ­¤æ—¶å†æ¬¡å¤±é…ï¼Œç”±äº æ­¤æ—¶çš„å…¨åŒ¹é…å­ä¸²æ˜¯ **AB**ï¼Œæ˜¯`æ²¡æœ‰é‡å¤å‰åç¼€`çš„ï¼Œç›´æ¥æŠŠ P ä¸²å³ç§»åˆ°å¤±é…ä½ç½®ï¼Œè¿™å’Œ 1 æ˜¯ä¸€ä¸ªé€»è¾‘

<!-- endtab -->

<!-- tab 4 -->

{% asset_img 7.png é‡æ–°å¼€å§‹åŒ¹é…ï¼Œé‡å¤ä¸Šé¢çš„é€»è¾‘  %}

<!-- endtab -->

<!-- tab 5 -->

{% asset_img 8.png å†æ¬¡å¤±é…ï¼Œå’Œ2ä¸€æ ·çš„å¤„ç†æ–¹å¼  %}

<!-- endtab -->

<!-- tab 6 -->

{% asset_img 9.png å½“Pä¸²å…¨éƒ¨åŒ¹é…æ—¶ï¼Œç¨‹åºé€€å‡º  %}

<!-- endtab -->

{% endtabs %}

é€šè¿‡ä¸Šé¢ KMP ç®—æ³•çš„æ¼”ç¤ºè¿‡ç¨‹ï¼Œå¯ä»¥å‘ç°ï¼Œæœ€å…³é”®çš„å°±æ˜¯æ±‚è§£`æ ¹æ®å½“å‰å…¨åŒ¹é…çš„å­ä¸²æƒ…å†µï¼Œæ±‚è§£æœ€é•¿çš„å‰åç¼€ï¼ˆä¹Ÿå°±æ˜¯ç¬¬2æ­¥çš„ABï¼‰`ï¼Œå¾—å‡ºäº† AB çš„é•¿åº¦ï¼ŒP ä¸²çš„åç§»é•¿åº¦ä¹Ÿå°±å¯ä»¥çŸ¥é“äº†ã€‚ä¸ºä»€ä¹ˆæ˜¯æœ€é•¿ï¼Œå¯ä»¥è®¾æƒ³å½“å‰çš„å…¨åŒ¹é…å­ä¸²æ˜¯**AABAA**, æ­¤æ—¶ï¼Œ**A**ä¸**AA**éƒ½æ˜¯ç›¸åŒçš„å‰åç¼€ï¼Œå¦‚æœå¯¹é½ A çš„è¯ï¼Œåé¢çš„ AA çš„ç¬¬ä¸€ä¸ª A å°±ä¼šä¸¢å¤±åŒ¹é…é€»è¾‘ã€‚

### "Partial match" table (éƒ¨åˆ†åŒ¹é…è¡¨)

éƒ¨åˆ†åŒ¹é…è¡¨ï¼Œä¹Ÿå¯ä»¥ç†è§£æˆå¤±æ•ˆå‡½æ•°(_failure function_)ï¼Œä¸ºçš„å°±æ˜¯æ±‚è§£ä¸Šé¢çš„é—®é¢˜ã€‚æˆ‘ä»¬ä¸å¯èƒ½åœ¨åŒ¹é…è¿‡ç¨‹ä¸­å»è¿›è¡Œæ±‚è§£å‰åï¼Œä¸éš¾å‘ç°ï¼Œå¯¹äºå›ºå®šçš„ P ä¸²ï¼Œéƒ¨åˆ†åŒ¹é…è¡¨æ˜¯å®Œå…¨å¯æ±‚çš„ã€‚ä¾‹å¦‚ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼š
{% asset_img 10.png æšä¸¾æ‰€æœ‰å¯èƒ½çš„å…¨åŒ¹é…æƒ…å†µï¼Œå¯¹éƒ¨åˆ†åŒ¹é…è¡¨è¿›è¡Œæ±‚è§£  %}
å¦‚æœæšä¸¾æ¯ç§æƒ…å†µè¿›è¡Œæ±‚è§£ï¼Œé‚£æ•ˆç‡ä¼šå¾ˆä½ï¼Œä¸éš¾å‘ç°ï¼Œéšç€å…¨åŒ¹é…ä¸²çš„é•¿åº¦å¢åŠ ï¼Œæœ€é•¿å‰åç¼€è¦ä¹ˆåŠ  1ï¼Œè¦ä¹ˆå‡å°ï¼Œæ˜¯æœ‰æŸç§é€’æ¨å…³ç³»çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„æ€æƒ³æ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚
ä¸‹é¢æ‰æ˜¯ KMP ç®—æ³•çš„æ ¸å¿ƒï¼Œå¦‚ä½•é«˜æ•ˆçš„æ±‚è§£éƒ¨åˆ†åŒ¹é…è¡¨ï¼Œå‡è®¾æ±‚è§£çš„ PMT ä¸º fï¼Œf(x)ä¸ºæœ€é•¿é‡å¤å‰åç¼€çš„é•¿åº¦ã€‚

> `ç”±äºf(x)çš„å®šä¹‰ä»£è¡¨æœ€é•¿çš„å‰åç¼€çš„é•¿åº¦, å› æ­¤p[f(x)]åˆšå¥½å¯ä»¥è®¿é—®å½“å‰æœ€é•¿å‰ç¼€çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ˜¯ååˆ†é‡è¦çš„ç‰¹æ€§`ã€‚æƒ³é€šè¿™ä¸ªå°±æ¯”è¾ƒå®¹æ˜“ç†è§£é€’æ¨äº†ã€‚

{% asset_img 11.png åˆå§‹åŒ–PMTï¼Œæ‰€æœ‰å…ƒç´ ä¸º0ï¼Œç”±äº0å·å…ƒç´ åªæœ‰ä¸€ä½ï¼Œä¸å¯èƒ½æœ‰è§£ï¼Œå› æ­¤ä»1å¼€å§‹å¾ªç¯ %}
è€ƒè™‘ç¬¬ x ä½ç½®çš„æœ€é•¿å‰åç¼€{% katex %}f(x){% endkatex %}ï¼Œæœ‰ä¸¤ç§æƒ…å†µ

1. å¦‚æœ p[x]=p[f(x-1)]ï¼Œé‚£ä¹ˆ f(x)=f(x-1)+1ï¼Œè¿™å¾ˆå¥½ç†è§£ã€‚
2. å¦‚æœ p[x]!=p[f(x-1)]ï¼Œé‚£ä¹ˆåˆ†æƒ…å†µè®¨è®º
   {% asset_img 12.png å†æ¬¡è¿›å…¥ç±»ä¼¼çš„åˆ¤æ–­æµç¨‹ï¼Œè€Œé—®é¢˜æ˜¯æŠŠCæŒªåˆ°Aä½ç½®çš„é—®é¢˜ï¼ˆå®é™…æ•°æ®æ²¡æœ‰æŒªï¼Œåªæ˜¯è¿™ä¹ˆæ€è€ƒé—®é¢˜ï¼‰ %}
   {% asset_img 13.png è€ƒè™‘ä¸Šé¢çš„é—®é¢˜ï¼Œå¦‚æœä¸ç­‰ï¼Œé‚£å¿…ç„¶æ˜¯æ²¡æœ‰ç›¸ç­‰çš„å‰åç¼€äº†(æ­¤æ—¶å‰ç¼€åŒ…å«é¦–å­—æ¯) %}

å› æ­¤é€’æ¨å…³ç³»å¦‚ä¸‹ï¼š

{% katex %}f(x)=\left\{\begin{array}{lc}f(x-1)\;+\;1&p\lbrack f(x-1)\rbrack=p\lbrack x\rbrack\\f(f(x-1)\;-\;1)+1\;&p\lbrack f(x-1)\rbrack\neq p\lbrack x\rbrack\;and\;p\lbrack f(f(x-1)\;-\;1)\rbrack\;=\;p\lbrack x\rbrack\\0&p\lbrack f(x-1)\rbrack\neq p\lbrack x\rbrack\;and\;p\lbrack f(f(x-1)\;-\;1)\rbrack\;\neq\;p\lbrack x\rbrack\end{array}\right.{% endkatex %}

### KMPç®—æ³•

çœ‹åˆ°è¿™é‡Œï¼ŒKMP ç®—æ³•å·²ç»å¯ä»¥å†™å‡ºæ¥äº†ï¼Œå¯ä»¥è¯•ä¸€è¯•æ‰‹äº†

[28. æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡](https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/description/)

```javascript
/**
 * @param {string} haystack
 * @param {string} needle
 * @return {number}
 */
var strStr = function (haystack, needle) {
  // KMP
  let pmt = new Array(needle.length).fill(0);
  for (let i = 1; i < needle.length; i++) {
    if (needle[pmt[i - 1]] === needle[i]) {
      pmt[i] = pmt[i - 1] + 1;
    } else {
      if (needle[pmt[pmt[i - 1] - 1]] === needle[i]) {
        pmt[i] = pmt[pmt[i - 1] - 1] + 1;
      } else {
        pmt[i] = 0;
      }
    }
  }
  let i = 0;
  let j = 0;
  while (i < haystack.length) {
    if (haystack[i] !== needle[j]) {
      // è¿™é‡Œéœ€è¦åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œå¤±é…åç§»ï¼Œå¦åˆ™ä¼šå¹²æ‰°æ­£å¸¸çš„è¿­ä»£
      if (j > 0) {
        j = pmt[j - 1];
      } else {
        i++;
      }
    } else {
      // å·²ç»åŒ¹é…åˆ°pä¸²æœ€åä¸€ä½ï¼Œç¨‹åºé€€å‡º
      if (j === needle.length - 1) {
        return i - j;
      }
      i++;
      j++;
    }
  }
  return -1;
};
```

### KMPç®—æ³•-æ—¶é—´å¤æ‚åº¦

æ±‚è§£éƒ¨åˆ†åŒ¹é…è¡¨ç”¨äº†{% katex %}O(m){% endkatex %}ï¼ŒåŒ¹é…ç”¨äº†{% katex %}O(n){% endkatex %}ï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦ä¸º{% katex %}O(n)+O(m){% endkatex %}ã€‚

## Boyer-Moore algorithm (BM ç®—æ³•)

KMP ç®—æ³•å‘å¸ƒçš„åŒå¹´ï¼Œ Robert S. Boyer ä¸ J Strother Moore è®¾è®¡äº†è¯¥ç®—æ³•ã€‚å®ƒä¸éœ€è¦å¯¹è¢«æœç´¢çš„å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦è¿›è¡Œé€ä¸€æ¯”è¾ƒï¼Œè€Œä¼šè·³è¿‡å…¶ä¸­æŸäº›éƒ¨åˆ†ã€‚

ä¸ KMP ç®—æ³•ä¸åŒçš„æ˜¯å®ƒæ˜¯ä» p ä¸²æœ«å°¾å¼€å§‹æ¯”è¾ƒçš„ï¼Œå¦‚æœæœ€åä¸€ä¸ªå­—ç¬¦ä¸åŒ¹é…ï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦ç»§ç»­æ¯”è¾ƒå‰ä¸€ä¸ªå­—ç¬¦ã€‚å¦‚æœæœ€åä¸€ä¸ªå­—ç¬¦æœªåœ¨ P ä¸­å‡ºç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥è·³è¿‡ T çš„ n ä¸ªå­—ç¬¦ï¼Œæ¯”è¾ƒæ¥ä¸‹æ¥çš„ n ä¸ªå­—ç¬¦ï¼Œn ä¸º P çš„é•¿åº¦ã€‚å¦‚æœæœ€åä¸€ä¸ªå­—ç¬¦å‡ºç°åœ¨ P ä¸­ï¼Œé‚£ä¹ˆè·³è¿‡çš„å­—ç¬¦æ•°éœ€è¦è¿›è¡Œè®¡ç®—ï¼ˆä¹Ÿå°±æ˜¯å°† P æ•´ä½“å¾€åç§»ï¼‰ï¼Œç„¶åç»§ç»­å‰é¢çš„æ­¥éª¤æ¥æ¯”è¾ƒã€‚é€šè¿‡è¿™ç§å­—ç¬¦çš„ç§»åŠ¨æ–¹å¼æ¥ä»£æ›¿é€ä¸ªæ¯”è¾ƒæ˜¯è¿™ä¸ªç®—æ³•å¦‚æ­¤é«˜æ•ˆçš„å…³é”®æ‰€åœ¨ã€‚

ç›®å‰å¤§å¤šæ•°çš„è½¯ä»¶æŸ¥æ‰¾å¤§å¤šä½¿ç”¨è¯¥ç®—æ³•ã€‚ä¸‹é¢æ¥çœ‹ BM ç®—æ³•çš„è¿‡ç¨‹ï¼š

{% tabs Brute Force algorithm %}

<!-- tab 1 -->

{% asset_img 14.png ä¸KMPç®—æ³•ä¸åŒæ˜¯BMç®—æ³•ä»pä¸²æœ«å°¾å¼€å§‹æ¯”è¾ƒï¼Œæœ€åä¸€ä½ä¸åŒæ„å‘³ç€åŒ¹é…ä½ç½®iä¸å¯èƒ½æˆåŠŸ %}

> å¯ä»¥å‘ç°å¤±é…çš„"S"æœªæ›¾å‡ºç°åœ¨ P ä¸²ä¸­ï¼Œå› æ­¤å¯ä»¥æŠŠ p ä¸²ç§»åŠ¨åˆ°`å¤±é…ä½ç½®åé¢`ï¼ˆ"S"ä¸å¯èƒ½ä¸ p ä¸²ä¸­çš„ä»»ä½•ä¸€ä¸ªå­—æ¯ç›¸ç­‰ï¼‰

{% asset_img 15.png ä»å¤±é…ä½ç½®åå¼€å§‹åŒ¹é… %}

<!-- endtab -->

<!-- tab 2 -->

{% asset_img 16.png å¤±é…çš„Pä¸å¯ä»¥åƒ1é‚£ä¹ˆå¤„ç†ï¼Œå› ä¸ºå­—ç¬¦Påœ¨pä¸²ä¸­å‡ºç°è¿‡ï¼Œå› æ­¤åªèƒ½æŠŠå­—ç¬¦På¯¹é½ %}

{% asset_img 17.png åƒè¿™æ · %}

> åˆ°è¿™é‡Œå¯ä»¥æ€»ç»“å‡º BM ç®—æ³•çš„ç¬¬ä¸€æ¡è§„åˆ™ï¼šThe bad-character rule (åå­—ç¬¦è§„åˆ™)ã€‚
>
> 1. T ä¸²çš„å¤±é…å­—ç¬¦å¦‚æœæœªå‡ºç°åœ¨ p ä¸²ä¸­ï¼Œé‚£ä¹ˆ p ä¸²å³ç§»åˆ°å¤±é…ä½ç½®åé¢ã€‚
> 2. å¦‚æœå‡ºç°è¿‡ï¼Œå¯¹é½å³å¯ã€‚

<!-- endtab -->

<!-- tab 3 -->

{% asset_img 18.png å¯¹é½åä¾ç„¶ä»æœ«å°¾å¾€å‰åŒ¹é…ï¼Œè¿™é‡Œçš„Pæ˜¯å¯¹é½è¿‡çš„ï¼ˆå¯ä»¥è·³è¿‡ï¼‰ %}

> åˆ°è¿™é‡Œå¯ä»¥ä»‹ç»ç¬¬äºŒç§è§„åˆ™äº†ï¼ŒThe good-suffix rule (å¥½åç¼€è§„åˆ™)ã€‚
> å¥½åç¼€æŒ‡çš„å°±æ˜¯`å…¨åŒ¹é…çš„è“è‰²éƒ¨åˆ†`ï¼Œç›´è§‚æ„Ÿè§‰å°±æ˜¯æŠŠ p ä¸²å¾€åç§»åŠ¨åˆ°ä¸€ä¸ªå¯ä»¥å’Œå¥½åç¼€é‡æ–°åŒ¹é…çš„ä½ç½®ã€‚

{% asset_img 19.png  %}

<!-- endtab -->

<!-- tab 4 -->

{% asset_img 20.png é‡‡ç”¨å¥½åç¼€è§„åˆ™åå†æ¬¡å¤±é…ï¼Œç”±äºæ²¡æœ‰å¥½åç¼€ï¼Œå› æ­¤é‡‡ç”¨åå­—ç¬¦è§„åˆ™å¯¹é½å­—ç¬¦P %}

{% asset_img 21.png æœ€åå®ŒæˆåŒ¹é… %}

<!-- endtab -->

{% endtabs %}

### Shift rules Table (è½¬ç§»è§„åˆ™è¡¨)

ä¸ KMP ç®—æ³•ç±»ä¼¼ï¼ŒBM ç®—æ³•ä¹Ÿæ˜¯éœ€è¦é¢„å¤„ç†çš„ï¼Œä¸¤ç§è§„åˆ™çš„åç§»æ•°å€¼æ˜¯å¯ä»¥é¢„å…ˆæ±‚å‡ºæ¥çš„ã€‚

#### The good-suffix rule (å¥½åç¼€è§„åˆ™)

å¥½åç¼€è§„åˆ™ä¸»è¦å€Ÿé‰´äº†è¿™ç¯‡[Boyer-Moore: Good suffix rule](https://hyperskill.org/learn/step/36987)çš„æ€è·¯ã€‚

##### æƒ…å†µ 1

ä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„ä¾‹å­ï¼š

{% asset_img 22.png %}

> è€ƒè™‘å½“å‰æƒ…å†µï¼Œåç¼€`AB`åŒ¹é…æˆåŠŸï¼Œ`D`åŒ¹é…å¤±è´¥ï¼Œå¦‚æœå¯¹é½`3å·AB`ï¼Œé‚£`3å·AB`å‰çš„`D`åˆä¼šä½¿å¾—ç®—æ³•è¿›å…¥ä¸€æ¬¡é‡å¤çš„åŒ¹é…ï¼ˆè™½ç„¶ä½ç½®ä¸ä¸€æ ·ï¼‰ï¼Œè¿™ç§å¥½åç¼€çš„åç§»å¯ä»¥åœ¨é¢„å¤„ç†çš„æ—¶å€™å¤„ç†æ‰ã€‚

{% asset_img 23.png å¯¹é½2å·ABæ˜¯è‰¯æ€§çš„å¥½åç¼€è§„åˆ™ %}

> æ­¤æ—¶ i æŒ‡é’ˆçš„åç§»ä¸º 8ï¼Œç­‰äº`AB`çš„é•¿åº¦(2)+`2å·AB`å¯¹é½æ‰€éœ€è¦çš„åç§»(6) = 8
> ä¸ºä»€ä¹ˆä¼šå‡ºç°éœ€è¦ç§»åŠ¨åˆ° 2 å· AB çš„æƒ…å†µï¼Ÿ
> ä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œ3 å· AB æ— æ³•ä½¿ç”¨æ˜¯å› ä¸ºï¼Œä¸‰å· AB æ˜¯ç›¸åŒæœ€é•¿åç¼€`BADBA`çš„åç¼€ï¼Œæ¢å¥è¯è¯´ï¼Œå› ä¸º`BADBA`æ‰æ˜¯ç›¸åŒæœ€é•¿åç¼€ï¼Œå› æ­¤å®ƒçš„å­åç¼€ï¼ˆä¾‹å¦‚ï¼šB, BAD, BADB...ï¼‰å…¨éƒ½ä¼šé™·å…¥ 3 å· AB çš„æƒ…å†µã€‚

##### æƒ…å†µ 2

å¦‚æœå¥½åç¼€æœªæ›¾å‡ºç°è¿‡ï¼Œé‚£åˆè¯¥æ€ä¹ˆåç§»å‘¢ï¼Ÿä¾‹å¦‚è¿™ä¸ªä¾‹å­:

{% asset_img 24.png æ­¤æ—¶å¥½åç¼€BDBå¹¶æœªå‡ºç°åœ¨pä¸²çš„å…¶ä»–åœ°æ–¹ï¼Œä½†æ˜¯æ­¤æ—¶å¯¹é½DBæ˜¯åˆç†çš„ï¼ˆå› ä¸ºDBæ˜¯å‰ç¼€ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯å¸¸è¯´çš„å‡è®¾pä¸²å‰æœ‰è™šæ‹Ÿå­—ç¬¦ï¼ˆä¸ªäººæ„Ÿè§‰æŒºè¯¯å¯¼çš„ï¼‰ %}

> æ­¤æ—¶ i æŒ‡é’ˆçš„åç§»ä¸º 8ï¼Œç­‰äº`BDB`çš„é•¿åº¦(3)+`DB`å¯¹é½æ‰€éœ€è¦çš„åç§»(5) = 8

ç›¸åçš„ï¼Œå¦‚æœæ²¡æœ‰å‰ç¼€ä¸ä»»ä¸€å­åç¼€åŒ¹é…ï¼Œé‚£å°±åªèƒ½åç§»åˆ° p ä¸²åé¢äº†ã€‚åƒè¿™æ ·ï¼š

{% asset_img 25.png %}

> æ­¤æ—¶ i æŒ‡é’ˆçš„åç§»ä¸º 8ï¼Œç­‰äº`BDB`çš„é•¿åº¦(3)+p ä¸²é•¿åº¦(7) = 10

##### å¥½åç¼€è§„åˆ™ç®—æ³•

å¯¹äºä»åå¾€å‰è¿­ä»£çš„æƒ…å†µä¸‹ï¼ˆi ä» 0->nï¼‰ï¼Œæ±‚è§£ä»åå¾€å‰çš„ä»»ä¸€ä½ç½®å‡ºå‘èƒ½æ„æˆçš„æœ€é•¿çš„ä¸”ä¸åç¼€ç­‰é•¿çš„å­ä¸²ã€‚è®°ä¸º Z(i)ï¼Œ
{% asset_img 26.png %}
å¯¹äºä»»ä¸€ i, å¦‚æœ Z(i)>0ï¼Œå°±æ„å‘³ç€ï¼š`åç§»é•¿åº¦iå¯ä»¥å¯¹é½Z(i)é•¿åº¦çš„å¥½åç¼€ï¼Œ(å¹¶ä¸”æ­¤æ—¶å¥½åç¼€å·¦ä¾§çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¹Ÿä¸ç›¸ç­‰ï¼Œä¹Ÿå°±è§„é¿äº†3å·ABçš„é—®é¢˜)ã€‚`
ä¸æ­¤åŒæ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ª Z å€¼ç›¸ç­‰ï¼Œåº”è¯¥ä½¿ç”¨`è¾ƒå°çš„åç§»`ï¼Œä¾‹å¦‚ä¸Šé¢çš„ `2å·AB`çš„ä¾‹å­ï¼Œæ­¤æ—¶ä¸åº”è¯¥å¯¹é½ i è¾ƒå¤§çš„`1å·AB`ï¼Œå¦åˆ™ä¼šæ¼æ‰åŒ¹é…æœºä¼šã€‚

å€ŸåŠ© Z å‡½æ•°ï¼Œå¯ä»¥å¡«å……æœ€ç»ˆå¥½åç¼€è§„åˆ™çš„æƒ…å†µ 1ã€‚

##### Z-Algorithm (Z ç®—æ³•)

è€Œä¸Šé¢è¿™ä¸ª Z å‡½æ•°å°±æ˜¯å°† p ä¸²ç¿»è½¬åè¿›è¡Œ Z-Algorithm(Z ç®—æ³•)ï¼Œä¹Ÿå¸¸å¸¸è¢«ç§°ä¸ºæ‰©å±• KMPï¼Œæ„Ÿè§‰å’Œ KMP æ²¡å•¥å…³ç³» ğŸ˜¥ã€‚Dan Gusfield åœ¨ä»–çš„ä¹¦ã€ŠAlgorithms on Strings, Trees, and Sequencesã€‹ä¸­è®¨è®ºäº† Z å€¼ã€‚å°½ç®¡æœ‰ä¸€äº›äº‰è®®ï¼Œä½†æœ‰äººå£°ç§° Dan Gusfield æ˜¯ Z ç®—æ³•çš„å‘æ˜è€…ã€‚Z å€¼æ˜¯ Z ç®—æ³•ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œç”¨äºè®¡ç®—å­—ç¬¦ä¸²ä¸­åŒ¹é…å‰ç¼€çš„æœ€é•¿å­ä¸²çš„é•¿åº¦ã€‚

åœ¨ Z ç®—æ³• ä¸­ï¼Œå¯¹äºä¸€ä¸ªå­—ç¬¦ä¸² {% katex %} S = \{S_0, S_1, Â·Â·Â·, S_{n-1}\}{% endkatex %}ï¼Œå®šä¹‰{% katex %}Z(i){% endkatex %}è¡¨ç¤ºä»ä½ç½® {% katex %}i{% endkatex %} å¼€å§‹çš„ {% katex %}S{% endkatex %} çš„åç¼€{% katex %}T_i = \{S_i, S_{i+1}, Â·Â·Â·, S{n-1}\}{% endkatex %}ä¸{% katex %}S{% endkatex %}çš„æœ€é•¿å…¬å…±å‰ç¼€çš„é•¿åº¦ã€‚

é€šå¸¸ï¼Œæš´åŠ›ç®—æ³•å¾ˆå¥½ç†è§£ï¼Œæ¯ä¸ªä½ç½®å¾€åæšä¸¾ï¼Œæœ€ç»ˆæ—¶é—´å¤æ‚åº¦æ˜¯{% katex %}O(n^2){% endkatex %}ã€‚è¿™æ ·çš„æ„å»ºæ–¹å¼å’Œ KMP ç®—æ³•æƒ³è¦è§£å†³çš„é—®é¢˜æ˜¯ä¸€æ ·çš„ï¼š`æ²¡æœ‰åˆ©ç”¨åŒ¹é…è®°å¿†`ã€‚å¦‚ä½•åˆ©ç”¨åŒ¹é…è®°å¿†ï¼Œç›´æ¥çœ‹ç®—æ³•æµç¨‹ï¼š

{% tabs Z-Algorithm %}

<!-- tab 1 -->

{% asset_img 27.png Zç®—æ³•æœ€é‡è¦çš„æ¦‚å¿µå°±æ˜¯Z-Boxï¼ŒZ-Boxè®°å½•äº†æš´åŠ›æ±‚è§£çš„åŒºé—´ %}

> ä¾‹å¦‚æ±‚è§£ä½ç½® i çš„ Z å€¼æ—¶ï¼Œæš´åŠ›å¾€åæ±‚è§£å‡º Z(i)ï¼Œé‚£ä» i åˆ°`i+Z(i)`çš„åŒºé—´å°±æ˜¯æ­¤æ—¶çš„ Z-Box

<!-- endtab -->
<!-- tab 2 -->

è®°å½• Z-Box çš„èŒƒå›´æœ‰å•¥ç”¨å‘¢ï¼Ÿ
{% asset_img 28.png åœ¨Z-Boxå†…çš„Zå€¼å¯ä»¥ç­‰ä»·æ˜ å°„åˆ°ä¹‹å‰å·²ç»æ±‚è§£çš„Zå€¼ %}

> ä¾‹å¦‚æ±‚è§£ä½ç½® i+1 çš„ Z å€¼æ—¶ï¼Œi+1 ä½ç½®é¢ä¸´çš„æƒ…å†µå’Œ 1 ä½ç½®çš„æƒ…å†µæ˜¯ä¸€è‡´çš„ã€‚

é‚£ç›´æ¥è®© Z(i+1) = Z(1)å¯ä»¥å—ï¼Ÿç­”æ¡ˆæ˜¯ä¹Ÿä¸è¡Œã€‚

å¦‚æœ Z(1)çš„å€¼ä½¿å¾—[i+1]åç§»`ä»åœ¨Z-Boxçš„èŒƒå›´å†…`ï¼Œé‚£æƒ…å†µå°±æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œç›¸åçš„ï¼Œå¦‚æœ Z(1)çš„å€¼ä½¿å¾—[i+1]çš„åç§»`è¶…è¿‡äº†Z-Boxçš„èŒƒå›´`ï¼Œé‚£å°±éœ€è¦ç»§ç»­å¾€åæš´åŠ›æ±‚è§£ã€‚

<!-- endtab -->
<!-- tab 3 -->

å¯¹äº 0 çš„æƒ…å†µï¼Œæœ‰äº›æ–¹æ³•æ˜¯å½“ 0 å¤„ç†ï¼Œæœ‰äº›æ˜¯ç­‰äºæ•´ä¸ªå­—ç¬¦ä¸²é•¿åº¦ï¼Œè¿˜æ˜¯æŒ‰å®é™…æƒ…å†µéœ€è¦ç»™å€¼ã€‚Z-Box å®ç°å°±ç”¨ä¸¤ä¸ªæŒ‡é’ˆå³å¯ã€‚è¿™é‡Œç•™ä¸‹ä¸€ä¸ªç®—æ³•æ‰§è¡Œæµç¨‹å¯è§†åŒ–çš„ç½‘ç«™ï¼š[Z Algorithm](https://personal.utdallas.edu/~besp/demo/John2010/z-algorithm.htm)

```javascript
function zFunc(str) {
  const z = Array(str.length).fill(0);
  let l = 0,
    r = 0;
  for (let i = 1; i < str.length; i++) {
    // æ˜¯å¦åœ¨Z-Boxä¸­
    if (i < r) {
      // Z-Boxä¸­å‰©ä½™çš„é•¿åº¦å¤ŸZ[i-l]
      if (z[i - l] < r - i) {
        z[i] = z[i - l];
        continue;
      } else {
        // è‡³å°‘å¯ä»¥å¤ç”¨r-iä¸ªå­—ç¬¦
        z[i] = r - i;
      }
    }
    // æš´åŠ›æ±‚è§£
    while (i + z[i] < str.length && str[z[i]] === str[i + z[i]]) {
      z[i]++;
    }
    l = i;
    r = i + z[i];
  }
  return z;
}
```

<!-- endtab -->

{% endtabs %}

##### å‰ç¼€åŒ¹é…

å€’åº p ä¸²ç®—å®Œ Z å‡½æ•°ï¼Œå¡«å……å®Œæƒ…å†µ 1ï¼Œæ€ä¹ˆå¤„ç†æƒ…å†µ 2 å‘¢ï¼Ÿ
å†æ¬¡è§‚å¯Ÿ Z å‡½æ•°å¯ä»¥å‘ç°ï¼Œå½“`i+Z(i)`ç­‰äº p ä¸²é•¿åº¦æ—¶ï¼Œæ„å‘³ç€ p ä¸²åç§» i åæœ‰ Z(i)é•¿åº¦çš„é‡å¤ä¸²ï¼Œæ­¤æ—¶ Z(i)é•¿åº¦çš„é‡å¤ä¸²åˆšå¥½æ˜¯`pä¸²çš„å‰ç¼€`ã€‚

{% asset_img 30.png %}

##### æ„å»ºåç§»è¡¨

åˆ°æ­¤å¯ä»¥æ„å»ºå‡º i æŒ‡é’ˆçš„åç§»è¡¨äº† gsrï¼Œgsr(i)ä»£è¡¨`å¥½åç¼€é•¿åº¦ä¸ºiæ—¶ï¼ŒiæŒ‡é’ˆéœ€è¦åç§»çš„é•¿åº¦`

è€ƒè™‘åˆ° i æŒ‡é’ˆçš„åç§»éœ€è¦å…ˆåç§»å¥½åç¼€çš„é•¿åº¦ï¼Œå› æ­¤åˆå§‹åŒ–è¡¨çš„æ—¶å€™åŠ ä¸Šç´¢å¼•ã€‚[p.len, p.len+1, ..., p.len+p.len]

{% tabs Build GSR %}

<!-- tab ç®—æ³•æµç¨‹ -->

{% asset_img 31.png %}

<!-- endtab -->
<!-- tab ä»£ç  -->

```javascript
function buildGSR(needle) {
  // åˆå§‹åŒ–ä¸ºæ‰€æœ‰çš„å¥½åç¼€æƒ…å†µéƒ½åç§»åˆ°pä¸²åé¢
  const gsr = _.range(needle.length, 2 * needle.length);
  // æ— å¥½åç¼€ï¼Œåªç§»åŠ¨æœ€å·®çš„1ä½
  gsr[0] = 1;
  const z = zReverseFunc(needle);
  for (let i of _.range(1, z.length)) {
    if (z[i]) {
      // æƒ…å†µ1
      gsr[z[i]] = Math.min(gsr[z[i]] || Infinity, i + z[i]);
    }
  }
  for (let i of _.range(1, z.length)) {
    if (z[i] + i === needle.length) {
      // æ­¤æ—¶æ˜¯ä¸€ä¸ªå‰ç¼€
      // æƒ…å†µ2
      for (let j of _.range(z[i] + 1, gsr.length)) {
        gsr[j] = Math.min(gsr[j], i + j);
      }
    }
  }
  return gsr;
}

function zReverseFunc(str) {
  const n = str.length;
  const z = Array(n).fill(0);
  let l = 0,
    r = 0;
  for (let i = 1; i < n; i++) {
    // æ˜¯å¦åœ¨Z-Boxä¸­
    if (i < r) {
      // Z-Boxä¸­å‰©ä½™çš„é•¿åº¦å¤ŸZ[i-l]
      if (z[i - l] < r - i) {
        z[i] = z[i - l];
        continue;
      } else {
        z[i] = r - i;
      }
    }
    // æš´åŠ›æ±‚è§£
    // è¿™é‡Œä»åå¾€å‰å–å€¼ï¼Œé¿å…ç¿»è½¬å­—ç¬¦ä¸²
    while (
      n - 1 - (i + z[i]) >= 0 &&
      str[n - 1 - z[i]] === str[n - 1 - (i + z[i])]
    ) {
      z[i]++;
    }
    l = i;
    r = i + z[i];
  }
  return z;
}
```

<!-- endtab -->

{% endtabs %}

#### The bad-character rule (åå­—ç¬¦è§„åˆ™)

ä¸€å¼ å“ˆå¸Œè¡¨è®°å½•ä¸‹`å½“å‡ºç°å¤±é…å­—ç¬¦`æ—¶ï¼Œi æŒ‡é’ˆéœ€è¦åç§»çš„å€¼ï¼ˆå…¶å®å°±æ˜¯è¯¥å­—ç¬¦åˆ°æœ«å°¾çš„ä½ç½®ï¼‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œp ä¸²é‡å¤å‡ºç°çš„å­—ç¬¦æ€»æ˜¯éœ€è¦ä¼˜å…ˆé‡‡ç”¨é å³çš„å­—ç¬¦å»å¯¹é½ï¼ˆå’Œ 1 å· AB æ˜¯ä¸€ä¸ªé“ç†ï¼‰ï¼Œå› æ­¤ä»å·¦å¾€å³è¿­ä»£ p ä¸²ï¼Œè¦†ç›–æ›´æ–°å³å¯ã€‚
å¯ä»¥å‚è€ƒè¿™ç¯‡ [Boyer-Moore: Bad character rule](https://hyperskill.org/learn/step/35869)

```javascript
import _ from "lodash";

function buildBCR(needle) {
  const bcr = {};
  for (let i of _.range(needle.length)) {
    const c = needle[i];
    bcr[c] = needle.length - 1 - i;
  }
  return bcr;
}
```

### BMç®—æ³•

{% tabs BM-algo %}
<!-- tab javascript -->
```javascript
/**
 * @param {string} haystack
 * @param {string} needle
 * @return {number}
 */
var strStr = function (haystack, needle) {
  // BM algo
  const bcr = {};
  for (let i of _.range(needle.length)) {
    const c = needle[i];
    bcr[c] = needle.length - 1 - i;
  }

  // åˆå§‹åŒ–ä¸ºæ‰€æœ‰çš„å¥½åç¼€æƒ…å†µéƒ½åç§»åˆ°pä¸²åé¢
  const gsr = _.range(needle.length, 2 * needle.length);
  // æ— å¥½åç¼€ï¼Œåªç§»åŠ¨æœ€å·®çš„1ä½
  gsr[0] = 1;
  const z = zReverseFunc(needle);
  for (let i of _.range(1, z.length)) {
    if (z[i]) {
      gsr[z[i]] = Math.min(gsr[z[i]] || Infinity, i + z[i]);
    }
  }
  for (let i of _.range(1, z.length)) {
    if (z[i] + i === needle.length) {
      // æ­¤æ—¶æ˜¯ä¸€ä¸ªå‰ç¼€
      for (let j of _.range(z[i] + 1, gsr.length)) {
        gsr[j] = Math.min(gsr[j], i + j);
      }
    }
  }
  let i = needle.length - 1,
    j = needle.length - 1;
  while (i < haystack.length) {
    if (haystack[i] !== needle[j]) {
      // é€‰æ‹©åç§»ä½æ•°å¤šçš„æ–¹æ¡ˆ
      i += Math.max(
        gsr[needle.length - 1 - j],
        bcr[haystack[i]] === undefined ? needle.length : bcr[haystack[i]],
      );
      j = needle.length - 1;
    } else {
      if (j === 0) {
        return i;
      }
      i--;
      j--;
    }
  }
  return -1;
};

// å€’åºZç®—æ³•
const zReverseFunc = (str) => {
  const n = str.length;
  const z = Array(n).fill(0);
  let l = 0,
    r = 0;
  for (let i = 1; i < n; i++) {
    // æ˜¯å¦åœ¨Z-Boxä¸­
    if (i < r) {
      // Z-Boxä¸­å‰©ä½™çš„é•¿åº¦å¤ŸZ[i-l]
      if (z[i - l] < r - i) {
        z[i] = z[i - l];
        continue;
      } else {
        z[i] = r - i;
      }
    }
    // æš´åŠ›æ±‚è§£
    while (
      n - 1 - (i + z[i]) >= 0 &&
      str[n - 1 - z[i]] === str[n - 1 - (i + z[i])]
    ) {
      z[i]++;
    }
    l = i;
    r = i + z[i];
  }
  return z;
};
```
<!-- endtab -->
<!-- tab Chromium Source Code -->
``` C++
[Boyer-Moore string search](https://source.chromium.org/chromium/chromium/src/+/main:v8/src/strings/string-search.h;drc=fa67bc861debe561f482e5023096ced07cf33f45;bpv=1;bpt=1;l=297)
//---------------------------------------------------------------------
// Boyer-Moore string search
//---------------------------------------------------------------------

template <typename PatternChar, typename SubjectChar>
int StringSearch<PatternChar, SubjectChar>::BoyerMooreSearch(
    StringSearch<PatternChar, SubjectChar>* search,
    base::Vector<const SubjectChar> subject, int start_index) {
  base::Vector<const PatternChar> pattern = search->pattern_;
  int subject_length = subject.length();
  int pattern_length = pattern.length();
  // Only preprocess at most kBMMaxShift last characters of pattern.
  int start = search->start_;

  int* bad_char_occurence = search->bad_char_table();
  int* good_suffix_shift = search->good_suffix_shift_table();

  PatternChar last_char = pattern[pattern_length - 1];
  int index = start_index;
  // Continue search from i.
  while (index <= subject_length - pattern_length) {
    int j = pattern_length - 1;
    int c;
    while (last_char != (c = subject[index + j])) {
      int shift = j - CharOccurrence(bad_char_occurence, c);
      index += shift;
      if (index > subject_length - pattern_length) {
        return -1;
      }
    }
    while (j >= 0 && pattern[j] == (c = subject[index + j])) j--;
    if (j < 0) {
      return index;
    } else if (j < start) {
      // we have matched more than our tables allow us to be smart about.
      // Fall back on BMH shift.
      index += pattern_length - 1 -
               CharOccurrence(bad_char_occurence,
                              static_cast<SubjectChar>(last_char));
    } else {
      int gs_shift = good_suffix_shift[j + 1];
      int bc_occ = CharOccurrence(bad_char_occurence, c);
      int shift = j - bc_occ;
      if (gs_shift > shift) {
        shift = gs_shift;
      }
      index += shift;
    }
  }

  return -1;
}
```
<!-- endtab -->

{% endtabs %}

### BMç®—æ³•-æ—¶é—´å¤æ‚åº¦

Boyer-Mooreç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å¾ˆæœ‰è¶£ï¼Œå› ä¸ºå®ƒä¸éµå¾ªé€šå¸¸çš„è§„åˆ™ã€‚åœ¨æœ€ä½³æƒ…å†µä¸‹ï¼Œå³æ¯æ¬¡å­—ç¬¦æ¯”è¾ƒéƒ½å¯¼è‡´ä¸åŒ¹é…çš„æƒ…å†µä¸‹ï¼Œè¯¥ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º{% katex %} O(\frac{n}{m}){% endkatex %} ï¼Œå…¶ä¸­{% katex %}n{% endkatex %} æ˜¯æ–‡æœ¬ä¸²çš„é•¿åº¦ï¼Œè€Œ {% katex %}m{% endkatex %} æ˜¯æœç´¢ä¸²çš„é•¿åº¦ã€‚è¿™æ˜¯å› ä¸ºåœ¨æ¯æ¬¡ä¸åŒ¹é…åï¼Œç®—æ³•å¯ä»¥è·³è¿‡ m ä¸ªå­—ç¬¦ï¼Œå¯¼è‡´ {% katex %} \frac{n}{m}{% endkatex %} æ¬¡æ¯”è¾ƒã€‚

åœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦å¯ä»¥æ˜¯ {% katex %}O(mn){% endkatex %}ï¼Œå³å½“pä¸²æ‰€æœ‰å­—ç¬¦éƒ½ç›¸åŒä¸”åŒ¹é…ç»“æœå‡ºç°åœ¨æ–‡æœ¬æœ«å°¾æ—¶å‘ç”Ÿã€‚ç„¶è€Œï¼Œåœ¨å®é™…æƒ…å†µä¸‹ï¼Œè¿™ç§æƒ…å†µä¸å¤ªå¯èƒ½å‘ç”Ÿã€‚å¹³å‡è€Œè¨€ï¼ŒBoyer-Mooreç®—æ³•è¡¨ç°è‰¯å¥½ï¼Œç‰¹åˆ«é€‚ç”¨äºé•¿æ¨¡å¼å’Œå¤§é‡æ–‡æœ¬ï¼Œä½¿å…¶æˆä¸ºæœ€æœ‰ç«äº‰åŠ›çš„å­—ç¬¦ä¸²æœç´¢ç®—æ³•ä¹‹ä¸€ã€‚
